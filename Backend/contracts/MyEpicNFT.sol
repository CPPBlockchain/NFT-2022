// SPDX-License-Identifier: UNLICENSED

pragma solidity ^0.8.0;

import "@openzeppelin/contracts/utils/Strings.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "hardhat/console.sol";

import { Base64 } from "./libraries/Base64.sol";

contract MyEpicNFT is ERC721URIStorage {
  using Counters for Counters.Counter;
  Counters.Counter private _tokenIds;

  event NewEpicNFTMinted(address sender, uint256 tokenId);

  constructor() ERC721 ("SquareNFT", "SQUARE") {
    console.log("This is my NFT contract.");
  }

  function makeAnEpicNFT() public {
    uint256 newItemId = _tokenIds.current();

    string memory json = Base64.encode(
        bytes(
            string(
                abi.encodePacked(
                    '{"name": "',
                    '", "description": "Description goes here.", "image": "data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMCAzMCI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTUxNS41LDU1MC42N3YtMzBoMzB2MzBabTEyLjkxLTEzLjg0LjA3LDBjMCwuMDUsMCwuMTEtLjA3LjE0LS4yLjE3LS40LjM0LS42MS40OWEuMTkuMTksMCwwLDEtLjE5LDAsLjQuNCwwLDAsMC0uNTUsMGwtMS4xMi45MWMtLjYyLjUyLTEuMjYsMS0xLjg4LDEuNTQtLjE4LjE0LS4xOC4yNCwwLC40MXMuNDkuNi43My45MWMuMTEuMTQuMTUuMTQuMjksMGwxLjI0LTEsMS44NC0xLjVhLjM5LjM5LDAsMCwwLC4xNC0uNTEuMTcuMTcsMCwwLDEsLjA2LS4yMmMuMTUtLjExLjI5LS4yMy40My0uMzVzLjIyLS4xOC40MSwwYTMuNywzLjcsMCwwLDAsMi4zMSwxLjIsNCw0LDAsMCwwLDIuMTUtLjI1LDQuMzYsNC4zNiwwLDAsMCwyLjUyLTVjMC0uMjYtLjE1LS41MS0uMjMtLjc4aC41NHY0LjY5aDEuMjl2LS4xOWMwLTEuNDQsMC0yLjg4LDAtNC4zMiwwLS4xNiwwLS4yLjItLjE5aDEuNjZjMC0uMjgsMC0uNTQsMC0uOHMtLjA1LS4xOS0uMTktLjE5aC0zLjlhLjUzLjUzLDAsMCwxLS4zOS0uMTYsNS45LDUuOSwwLDAsMC0uOC0uNyw0LDQsMCwwLDAtMy4yNS0uNTUsNCw0LDAsMCwwLTIuMiwxLjQ1LDUuMjQsNS4yNCwwLDAsMC0uNTUuOTEsOS4zMiw5LjMyLDAsMCwwLS4zNC44N2wtMS0yaC0uMDZsLTIuODksNS45aDEuMTVhLjI5LjI5LDAsMCwwLC4xMy0uMTIsNi4wNyw2LjA3LDAsMCwwLC4yNC0uNTkuMjEuMjEsMCwwLDEsLjIyLS4xNkg1MjhhLjQ3LjQ3LDAsMCwxLC4xNywwWm0tMy43NC0yLjU1aC0xLjU1cy0uMTMsMC0uMTMtLjA4YzAtLjQxLDAtLjgyLDAtMS4yNmgxLjg3Yy4xMSwwLC4xNSwwLC4xNS0uMTVzMC0uNSwwLS43NCwwLS4xNy0uMTctLjE3SDUyMS45Yy0uMTUsMC0uMTguMDUtLjE4LjE5LDAsMS43OCwwLDMuNTYsMCw1LjM0YTEsMSwwLDAsMCwwLC4xN0g1MjN2LTIuMjZoMS42OVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01MTUuNSAtNTIwLjY3KSIvPjxwYXRoIGQ9Ik01MjguNDEsNTM2LjgzbC0uMjUtLjA3YS40Ny40NywwLDAsMC0uMTcsMGgtMi4yYS4yMS4yMSwwLDAsMC0uMjIuMTYsNi4wNyw2LjA3LDAsMCwxLS4yNC41OS4yOS4yOSwwLDAsMS0uMTMuMTJoLTEuMTVsMi44OS01LjlINTI3bDEsMmE5LjMyLDkuMzIsMCwwLDEsLjM0LS44Nyw1LjI0LDUuMjQsMCwwLDEsLjU1LS45MSw0LDQsMCwwLDEsMi4yLTEuNDUsNCw0LDAsMCwxLDMuMjUuNTUsNS45LDUuOSwwLDAsMSwuOC43LjUzLjUzLDAsMCwwLC4zOS4xNmgzLjljLjE0LDAsLjIsMCwuMTkuMTlzMCwuNTIsMCwuOGgtMS42NmMtLjE1LDAtLjIsMC0uMi4xOSwwLDEuNDQsMCwyLjg4LDAsNC4zMnYuMTloLTEuMjlWNTMyLjloLS41NGMuMDguMjcuMTguNTIuMjMuNzhhNC4zNiw0LjM2LDAsMCwxLTIuNTIsNSw0LDQsMCwwLDEtMi4xNS4yNSwzLjcsMy43LDAsMCwxLTIuMzEtMS4yYy0uMTktLjItLjE5LS4yLS40MSwwcy0uMjguMjQtLjQzLjM1YS4xNy4xNywwLDAsMC0uMDYuMjIuMzkuMzksMCwwLDEtLjE0LjUxbC0xLjg0LDEuNS0xLjI0LDFjLS4xNC4xMS0uMTguMTEtLjI5LDAtLjI0LS4zMS0uNDgtLjYxLS43My0uOTFzLS4xNC0uMjcsMC0uNDFjLjYyLS41MSwxLjI2LTEsMS44OC0xLjU0bDEuMTItLjkxYS40LjQsMCwwLDEsLjU1LDAsLjE5LjE5LDAsMCwwLC4xOSwwYy4yMS0uMTUuNDEtLjMyLjYxLS40OSwwLDAsMC0uMDkuMDctLjE0Wm0zLjY3LTYuMDVjLS4yMiwwLS40NSwwLS42Ny4wNWEzLjkxLDMuOTEsMCwwLDAtMy4wNywzLjQsNCw0LDAsMCwwLC41NiwyLjQ5LDMuNTgsMy41OCwwLDAsMCwyLjUyLDEuNzYsMy41MywzLjUzLDAsMCwwLDMuMTEtLjg5LDMuODYsMy44NiwwLDAsMCwxLjI3LTIuNDEsNCw0LDAsMCwwLS4yOC0yLjA2QTMuNzcsMy43NywwLDAsMCw1MzIuMDgsNTMwLjc4Wm0tNS4xNSwzaDBsLS44NiwyaDEuNzhaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTE1LjUgLTUyMC42NykiLz48cGF0aCBkPSJNNTI0LjY3LDUzNC4yOHYxLjA1SDUyM3YyLjI2aC0xLjI0YTEsMSwwLDAsMSwwLS4xN2MwLTEuNzgsMC0zLjU2LDAtNS4zNCwwLS4xNCwwLS4xOS4xOC0uMTloMi45M2MuMTIsMCwuMTgsMCwuMTcuMTdzMCwuNDksMCwuNzQsMCwuMTUtLjE1LjE1SDUyM2MwLC40NCwwLC44NSwwLDEuMjYsMCwwLC4wOC4wOC4xMy4wOGgxLjU1WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTUxNS41IC01MjAuNjcpIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNTMyLjA4LDUzMC43OGEzLjc3LDMuNzcsMCwwLDEsMy40NCwyLjM0LDQsNCwwLDAsMSwuMjgsMi4wNiwzLjg2LDMuODYsMCwwLDEtMS4yNywyLjQxLDMuNTMsMy41MywwLDAsMS0zLjExLjg5LDMuNTgsMy41OCwwLDAsMS0yLjUyLTEuNzYsNCw0LDAsMCwxLS41Ni0yLjQ5LDMuOTEsMy45MSwwLDAsMSwzLjA3LTMuNEM1MzEuNjMsNTMwLjc5LDUzMS44Niw1MzAuOCw1MzIuMDgsNTMwLjc4Wm0tMS44Niw1LjMxdi4yYzAsLjM5LDAsLjc5LjA3LDEuMThhLjE1LjE1LDAsMCwwLC4xNC4xNmMuMTIsMCwuMjMuMDYuMzUuMDlhMy4xNywzLjE3LDAsMCwwLDIsMCwxLjc4LDEuNzgsMCwwLDAsLjI5LTMuMjNjLS4zOC0uMjUtLjgtLjQ1LTEuMTktLjY5YTEuNjYsMS42NiwwLDAsMS0uMzQtLjI1LjQ0LjQ0LDAsMCwxLC4xMS0uNzMuNzYuNzYsMCwwLDEsLjMzLS4wOCwyLjQ1LDIuNDUsMCwwLDEsMS4xOC4zNGwuMzUuMTljMC0uNDMsMC0uODIsMC0xLjJhLjIuMiwwLDAsMC0uMTMtLjE1LDMuNywzLjcsMCwwLDAtMi0uMTcsMS41NiwxLjU2LDAsMCwwLTEuMTgsMS45MywxLjgyLDEuODIsMCwwLDAsLjg5LDEuMWMuMzkuMjQuNzkuNDYsMS4xOC42OWEuNzUuNzUsMCwwLDEsLjQuNTIuNTkuNTksMCwwLDEtLjU5LjY3LDIuMTksMi4xOSwwLDAsMS0xLjM1LS4yNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01MTUuNSAtNTIwLjY3KSIvPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTUyNi45Myw1MzMuODJsLjg3LDJINTI2bC44Ni0yWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTUxNS41IC01MjAuNjcpIi8+PHBhdGggZD0iTTUzMC4yMiw1MzYuMDlsLjUxLjI4YTIuMTksMi4xOSwwLDAsMCwxLjM1LjI1LjU5LjU5LDAsMCwwLC41OS0uNjcuNzUuNzUsMCwwLDAtLjQtLjUyYy0uMzktLjIzLS43OS0uNDUtMS4xOC0uNjlhMS44MiwxLjgyLDAsMCwxLS44OS0xLjEsMS41NiwxLjU2LDAsMCwxLDEuMTgtMS45MywzLjcsMy43LDAsMCwxLDIsLjE3LjIuMiwwLDAsMSwuMTMuMTVjMCwuMzgsMCwuNzcsMCwxLjJsLS4zNS0uMTlhMi40NSwyLjQ1LDAsMCwwLTEuMTgtLjM0Ljc2Ljc2LDAsMCwwLS4zMy4wOC40NC40NCwwLDAsMC0uMTEuNzMsMS42NiwxLjY2LDAsMCwwLC4zNC4yNWMuMzkuMjQuODEuNDQsMS4xOS42OWExLjc4LDEuNzgsMCwwLDEtLjI5LDMuMjMsMy4xNywzLjE3LDAsMCwxLTIsMGMtLjEyLDAtLjIzLS4wNy0uMzUtLjA5YS4xNS4xNSwwLDAsMS0uMTQtLjE2YzAtLjM5LDAtLjc5LS4wNy0xLjE4WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTUxNS41IC01MjAuNjcpIi8+PC9zdmc+Cg==',
                    '"}'
                )
            )
        )
    );

    string memory finalTokenUri = string(
        abi.encodePacked("data:application/json;base64,", json)
    );

    console.log("\n--------------------");
    console.log(finalTokenUri);
    console.log("--------------------\n");

    _safeMint(msg.sender, newItemId);
  
    _setTokenURI(newItemId, finalTokenUri);
  
    _tokenIds.increment();
    console.log("An NFT w/ ID %s has been minted to %s", newItemId, msg.sender);
    emit NewEpicNFTMinted(msg.sender, newItemId);
  }
}